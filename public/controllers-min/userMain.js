app.filter("flow1024",function(){return function(n){return n<1e3?n+" B":n<1e6?(n/1e3).toFixed(2)+" KB":n<1e9?(n/1e6).toFixed(2)+" MB":n<1e12?(n/1e9).toFixed(2)+" GB":n}}),app.filter("relativeTime",function(){return function(n){var t="",e="",i=+new Date-new Date(n);i<0?i=-i:e="前";var o=Math.trunc(i/864e5),u=Math.trunc(i%864e5/36e5),a=Math.trunc(i%864e5%36e5/6e4);return o&&(t+=o+"天"),(o||u)&&(t+=u+"小时"),o||!u&&!a||(t+=a+"分钟"),i<6e4&&(t="几秒"),t+e}}),app.controller("UserMainController",function(n,t,e,i,o,u,a,c,l){n.innerSideNav=!0,n.menus=[{name:"首页",icon:"home",click:"user.index"},{name:"我的帐户",icon:"cloud",click:"user.account"},{name:"修改密码",icon:"lock_outline",click:"user.changePassword"},{name:"流量统计",icon:"timeline",click:"user.flow"},{name:"续费",icon:"vpn_key",click:"user.renew"}],n.publicInfo={title:"",menuButtonIcon:"menu",menuButtonState:"",menuButtonStateParams:{},fabButtonIcon:"",fabButtonClick:"",isLoading:!1,loadingText:"正在加载",messageTitle:"",messageData:"",buttonLeftFn:"",buttonRightFn:""},n.$on("$stateChangeStart",function(t,e,i,o,a){n.publicInfo.title="",n.publicInfo.menuButtonIcon="menu",n.publicInfo.menuButtonState="",n.publicInfo.menuButtonStateParams={},n.publicInfo.fabButtonIcon="",n.publicInfo.fabButtonClick="",n.publicInfo.isLoading=!1,n.publicInfo.loadingText="正在加载",n.publicInfo.MessageTitle="",n.publicInfo.MessageData="",n.publicInfo.buttonLeftFn="",n.publicInfo.buttonRightFn="",u.cancel()}),n.$on("$stateChangeSuccess",function(n,t,e,i,o){});var f=u.prompt({templateUrl:"/public/views/user/loading.html",escapeToClose:!1,scope:n,preserveScope:!0,controller:function(n){n.publicInfo.isLoading=!0}});n.loading=function(t){if(t)u.show(f);else var e=n.$watch("publicInfo.isLoading",function(){n.publicInfo.isLoading&&(u.cancel()["finally"](function(){n.publicInfo.isLoading=!1,n.publicInfo.loadingText="正在加载",n.publicInfo.messageTitle="",n.publicInfo.messageData="",n.publicInfo.buttonLeftFn="",n.publicInfo.buttonRightFn=""}),e())})},n.loadingMessage=function(t){t||(t={}),n.publicInfo.loadingText="",n.publicInfo.messageTitle=t.title,n.publicInfo.messageData=t.message,n.publicInfo.buttonLeftFn=t.left,n.publicInfo.buttonRightFn=t.right},n.menuButton=function(){n.publicInfo.menuButtonState?e.go(n.publicInfo.menuButtonState,n.publicInfo.menuButtonStateParams):l("gt-sm")?n.innerSideNav=!n.innerSideNav:i("left").toggle()},n.setTitle=function(t){n.publicInfo.title=t},n.setMenuButton=function(t,e){"default"===t?(n.publicInfo.menuButtonIcon="menu",n.publicInfo.menuButtonState="",n.publicInfo.menuButtonStateParams={}):(n.publicInfo.menuButtonIcon="arrow_back",n.publicInfo.menuButtonState=t,e&&(n.publicInfo.menuButtonStateParams=e))},n.setFabButtonClick=function(t){n.publicInfo.fabButtonClick=t},n.menuClick=function(t){e.go(n.menus[t].click),i("left").close()},n.bottomMenus=[{name:"退出登录",icon:"exit_to_app",click:function(){t.post("/api/home/logout").success(function(n){o.location.href="/"})}}],n.initPublicInfo=function(e){if(!n.publicInfo.messageData){if(e||(e={loading:!0}),!e.loading&&n.publicInfo.lastUpdate){var i=+new Date-n.publicInfo.lastUpdate;if(i<6e4)return}n.loading(e.loading),t.get("/api/user/userInfo").then(function(t){e.loading&&n.loading(!1),n.publicInfo.lastUpdate=new Date,n.publicInfo.user=t.data},function(t){401===t.status&&(o.location.href="/"),e.loading&&n.loadingMessage({message:"数据加载错误("+t.status+")",right:function(){o.location.reload()}})})}},n.initPublicInfo(),a(function(){"visible"===document.visibilityState&&n.initPublicInfo({loading:!1})},25e3),document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&n.initPublicInfo({loading:!1})}),n.version="0.0.0",t.get("/api/home/version").then(function(t){n.version=t.data})});