app.controller("AdminMainController",function(n,t,i,o,e,a,c,u,l,s){n.innerSideNav=!0,n.menuButton=function(){n.publicInfo.menuButtonState?n.publicInfo.menuButtonHistoryBackState?i.go(n.publicInfo.menuButtonHistoryBackState,n.publicInfo.menuButtonHistoryBackStateParams):i.go(n.publicInfo.menuButtonState,n.publicInfo.menuButtonStateParams):s("gt-sm")?n.innerSideNav=!n.innerSideNav:o("left").toggle()},n.menus=[{name:"首页",icon:"home",click:"admin.index"},{name:"服务器管理",icon:"cloud",click:"admin.server"},{name:"用户管理",icon:"face",click:"admin.user"},{name:"续费码",icon:"shop",click:"admin.renew"},{name:"流量统计",icon:"timeline",click:"admin.flow.server"},{name:"历史记录",icon:"watch_later",click:"admin.unfinish"},{name:"系统设置",icon:"settings",click:"admin.options"}],n.publicInfo={title:"",menuButtonIcon:"menu",menuButtonState:"",menuButtonStateParams:{},menuButtonHistoryBackState:"",menuButtonHistoryBackStateParams:{},menuButtonHistoryBackMark:!1,fabButtonIcon:"",fabButtonClick:"",isLoading:!1,loadingText:"正在加载",messageTitle:"",messageData:"",buttonLeftFn:"",buttonRightFn:"",methods:["aes-256-cfb","aes-192-cfb","aes-128-cfb","table","rc4","rc4-md5","chacha20","chacha20-ietf"],colors:["BDBDBD","FFCDD2","F8BBD0","E1BEE7","BBDEFB","B2DFDB","F0F4C3"],searchBar:!1,searchText:"",search:!1},n.flowChart={},n.$on("$stateChangeStart",function(t,i,o,e,c){n.publicInfo.title="",n.publicInfo.menuButtonIcon="menu",n.publicInfo.menuButtonState="",n.publicInfo.menuButtonStateParams={},n.publicInfo.fabButtonIcon="",n.publicInfo.fabButtonClick="",n.publicInfo.isLoading=!1,n.publicInfo.loadingText="正在加载",n.publicInfo.MessageTitle="",n.publicInfo.MessageData="",n.publicInfo.buttonLeftFn="",n.publicInfo.buttonRightFn="",n.publicInfo.searchBar=!1,n.publicInfo.searchText="",n.publicInfo.search=!1,a.cancel(),!n.publicInfo.menuButtonHistoryBackMark&&n.publicInfo.menuButtonHistoryBackState?n.publicInfo.menuButtonHistoryBackMark=!0:n.publicInfo.menuButtonHistoryBackMark&&(n.publicInfo.menuButtonHistoryBackState="",n.publicInfo.menuButtonHistoryBackStateParams={},n.publicInfo.menuButtonHistoryBackMark=!1)}),n.$on("$stateChangeSuccess",function(n,t,i,o,e){});var f=a.prompt({templateUrl:"/public/views/admin/loading.html",escapeToClose:!1,scope:n,preserveScope:!0,controller:function(n){n.publicInfo.isLoading=!0}});n.loading=function(t){if(t){if(n.publicInfo.isLoading)return;a.show(f)}else var i=n.$watch("publicInfo.isLoading",function(){n.publicInfo.isLoading&&(a.cancel()["finally"](function(){n.publicInfo.isLoading=!1,n.publicInfo.loadingText="正在加载",n.publicInfo.messageTitle="",n.publicInfo.messageData="",n.publicInfo.buttonLeftFn="",n.publicInfo.buttonRightFn=""}),i())})},n.loadingMessage=function(t){t||(t={}),n.publicInfo.loadingText="",n.publicInfo.messageTitle=t.title,n.publicInfo.messageData=t.message,n.publicInfo.buttonLeftFn=t.left,n.publicInfo.buttonRightFn=t.right},n.initPublicInfo=function(i){if(!n.publicInfo.messageData){if(i||(i={loading:!0}),!i.loading&&n.publicInfo.lastUpdate){var o=+new Date-n.publicInfo.lastUpdate;if(o<3e4)return}n.loading(i.loading);var a=[];a[0]=t.get("/api/admin/server"),a[1]=t.get("/api/admin/user"),a[2]=t.get("/api/admin/flow"),a[3]=t.get("/api/admin/code"),c.all(a).then(function(t){n.publicInfo.lastUpdate=new Date,t[0]&&(n.publicInfo.servers=t[0].data,n.$broadcast("initPublicInfo","server")),t[1]&&(n.publicInfo.users=t[1].data,n.$broadcast("initPublicInfo","user")),t[2]&&(n.publicInfo.servers.map(function(n){return n.account.map(function(i){var o=t[2].data.filter(function(t){return t.name===n.name&&t.port===i.port})[0];return o&&(i.today=o.today,i.week=o.week,i.month=o.month),i})}),n.$broadcast("initPublicInfo","flow")),t[3]&&(n.publicInfo.codes=t[3].data),i.loading&&n.loading(!1)})["catch"](function(t){401===t.status&&(e.location.href="/"),i.loading&&n.loadingMessage({message:"数据加载错误("+t.status+")",right:function(){e.location.reload()}})})}},n.initPublicInfo({loading:!0}),u(function(){"visible"===document.visibilityState&&(n.publicInfo.lastUpdate&&+new Date-n.publicInfo.lastUpdate>15e4?n.initPublicInfo({loading:!0}):n.initPublicInfo({loading:!1}))},1e4),document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&n.initPublicInfo({loading:!1})}),n.setTitle=function(t){n.publicInfo.title=t},n.setMenuButton=function(t,i){"default"===t?(n.publicInfo.menuButtonIcon="menu",n.publicInfo.menuButtonState="",n.publicInfo.menuButtonStateParams={}):(n.publicInfo.menuButtonIcon="arrow_back",n.publicInfo.menuButtonState=t,i&&(n.publicInfo.menuButtonStateParams=i))},n.setMenuButtonHistoryBack=function(){var t=i.current.name,o=i.params;n.publicInfo.menuButtonHistoryBackState=t,n.publicInfo.menuButtonHistoryBackStateParams=o},n.setFabButtonClick=function(t){n.publicInfo.fabButtonClick=t},n.menuClick=function(t){i.go(n.menus[t].click),o("left").close()},n.bottomMenus=[{name:"退出登录",icon:"exit_to_app",click:function(){t.post("/api/home/logout").success(function(n){e.location.href="/"})}}],n.showSearchBar=function(){n.publicInfo.searchBar=!0},n.hideSearchBar=function(){n.publicInfo.searchBar=!1},n.version="0.0.0",t.get("/api/home/version").then(function(t){n.version=t.data})});